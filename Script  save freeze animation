-- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

-- Ù…Ù„Ù Ø§Ù„Ø­ÙØ¸
local dances = {}
local saveFile = "Ø±Ù‚ØµØ§ØªÙŠ.json"
if isfile(saveFile) then
    local success, data = pcall(function()
        return HttpService:JSONDecode(readfile(saveFile))
    end)
    if success then dances = data end
end

local function saveToFile()
    writefile(saveFile, HttpService:JSONEncode(dances))
end

-- GUI
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "DanceGUI"

local openBtn = Instance.new("TextButton", gui)
openBtn.Size = UDim2.new(0, 100, 0, 30)
openBtn.Position = UDim2.new(0, 10, 0, 10)
openBtn.Text = "ğŸ“‚ ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©"
openBtn.BackgroundColor3 = Color3.fromRGB(40,40,40)
openBtn.TextColor3 = Color3.new(1,1,1)

local main = Instance.new("Frame", gui)
main.Position = UDim2.new(0, 10, 0, 50)
main.Size = UDim2.new(0, 320, 0, 400)
main.Visible = true
main.BackgroundColor3 = Color3.fromRGB(30,30,30)

local scrolling = Instance.new("ScrollingFrame", main)
scrolling.Position = UDim2.new(0, 10, 0, 90)
scrolling.Size = UDim2.new(1, -20, 1, -140)
scrolling.CanvasSize = UDim2.new(0, 0, 0, 5000)
scrolling.ScrollBarThickness = 6
scrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y
scrolling.BackgroundColor3 = Color3.fromRGB(20,20,20)

-- ğŸ”¥ ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù„Ø§Ù…Ø­Ø¯ÙˆØ¯
scrolling:GetPropertyChangedSignal("CanvasPosition"):Connect(function()
    if scrolling.CanvasPosition.Y > scrolling.AbsoluteCanvasSize.Y - scrolling.AbsoluteSize.Y - 50 then
        scrolling.CanvasSize = UDim2.new(0, 0, 0, scrolling.CanvasSize.Y.Offset + 3000)
    end
end)

local layout = Instance.new("UIListLayout", scrolling)
layout.Padding = UDim.new(0, 5)
layout.SortOrder = Enum.SortOrder.LayoutOrder

-- Ø¥Ø¯Ø®Ø§Ù„ ID ÙˆØªØ´ØºÙŠÙ„ (Ù…ÙØµØºØ±)
local idBox = Instance.new("TextBox", main)
idBox.Position = UDim2.new(0, 10, 0, 10)
idBox.Size = UDim2.new(0, 150, 0, 30) -- ÙƒØ§Ù† 200 ÙˆØµØºØ±Ù†Ø§Ù‡
idBox.PlaceholderText = "Animation ID"
idBox.BackgroundColor3 = Color3.fromRGB(60,60,60)
idBox.TextColor3 = Color3.new(1,1,1)

local playBtn = Instance.new("TextButton", main)
playBtn.Position = UDim2.new(0, 170, 0, 10) -- ÙƒØ§Ù† 220
playBtn.Size = UDim2.new(0, 60, 0, 30) -- ÙƒØ§Ù† 90 ÙˆØµØºØ±Ù†Ø§Ù‡
playBtn.Text = "â–¶ï¸"
playBtn.BackgroundColor3 = Color3.fromRGB(60,100,60)
playBtn.TextColor3 = Color3.new(1,1,1)

-- ğŸ†• Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø±Ø¹Ø© Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† + Ø²Ø± ØªØ·Ø¨ÙŠÙ‚
local speedBox = Instance.new("TextBox", main)
speedBox.Position = UDim2.new(0, 10, 0, 45) -- ØªØ­Øª ID Box
speedBox.Size = UDim2.new(0, 150, 0, 30)
speedBox.PlaceholderText = "Ù‡Ù†Ø§ ØªØ®ØªØ§Ø± Ø³Ø±Ø¹Ù‡"
speedBox.BackgroundColor3 = Color3.fromRGB(60,60,60)
speedBox.TextColor3 = Color3.new(1,1,1)

local applySpeedBtn = Instance.new("TextButton", main)
applySpeedBtn.Position = UDim2.new(0, 170, 0, 45) -- ØªØ­Øª Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„
applySpeedBtn.Size = UDim2.new(0, 60, 0, 30)
applySpeedBtn.Text = "ØªØ·Ø¨ÙŠÙ‚"
applySpeedBtn.BackgroundColor3 = Color3.fromRGB(60,100,100)
applySpeedBtn.TextColor3 = Color3.new(1,1,1)

local freezeBtn = Instance.new("TextButton", main)
freezeBtn.Position = UDim2.new(0, 10, 0, 80)
freezeBtn.Size = UDim2.new(0, 140, 0, 30)
freezeBtn.Text = "ğŸ§Š ØªØ¬Ù…ÙŠØ¯"
freezeBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
freezeBtn.TextColor3 = Color3.new(1,1,1)

local player = game.Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local humanoid = char:WaitForChild("Humanoid")
local animator = humanoid:WaitForChild("Animator")

-- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø²Ø± Ù„Ø¹Ø±Ø¶ Ø¢Ø®Ø± ID
local animBtn = Instance.new("TextButton", main)
animBtn.Position = UDim2.new(0, 120, 0, 80)
animBtn.Size = UDim2.new(0, 80, 0, 30)
animBtn.BackgroundColor3 = Color3.fromRGB(80,80,120)
animBtn.TextColor3 = Color3.new(1,1,1)
animBtn.Text = "â€”"

-- Ù…ØªØºÙŠØ± Ù„Ø­ÙØ¸ Ø¢Ø®Ø± ID
local currentAnimId = nil

-- Ù„Ù…Ø§ ÙŠØ¨Ø¯Ø£ Ø£ÙŠ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¬Ø¯ÙŠØ¯
animator.AnimationPlayed:Connect(function(track)
    if track and track.Animation and track.Animation.AnimationId then
        local id = string.match(track.Animation.AnimationId, "%d+")
        if id then
            currentAnimId = id
            animBtn.Text = id
        end
    end
end)

-- Ù†Ø³Ø® Ø§Ù„Ù€ ID
animBtn.MouseButton1Click:Connect(function()
    if currentAnimId then
        if setclipboard then
            setclipboard(currentAnimId)
            print("ØªÙ… Ù†Ø³Ø® Animation ID:", currentAnimId)
        else
            warn("Clipboard ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…")
        end
    else
        warn("Ù…Ø§ÙÙŠ Ø£ÙŠ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø´ØºØ§Ù„")
    end
end)

local saveBtn = Instance.new("TextButton", main)
saveBtn.Position = UDim2.new(0, 170, 0, 80)
saveBtn.Size = UDim2.new(0, 140, 0, 30)
saveBtn.Text = "ğŸ’¾ Ø­ÙØ¸"
saveBtn.BackgroundColor3 = Color3.fromRGB(100,100,30)
saveBtn.TextColor3 = Color3.new(1,1,1)

-- Ø£Ø³Ù‡Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ±
local scrollDown = Instance.new("TextButton", main)
scrollDown.Size = UDim2.new(0, 30, 0, 30)
scrollDown.Position = UDim2.new(1, -35, 1, -35)
scrollDown.Text = "â¬‡ï¸"
scrollDown.BackgroundColor3 = Color3.fromRGB(50,50,50)
scrollDown.TextColor3 = Color3.new(1,1,1)

local scrollUp = Instance.new("TextButton", main)
scrollUp.Size = UDim2.new(0, 30, 0, 30)
scrollUp.Position = UDim2.new(1, -35, 1, -75)
scrollUp.Text = "â¬†ï¸"
scrollUp.BackgroundColor3 = Color3.fromRGB(50,50,50)
scrollUp.TextColor3 = Color3.new(1,1,1)

-- ØªÙ…Ø±ÙŠØ± Ù…Ø³ØªÙ…Ø±
local scrollingFlag = false
local scrollSpeed = 6

local function startScroll(direction)
    scrollingFlag = true
    while scrollingFlag do
        scrolling.CanvasPosition = scrolling.CanvasPosition + Vector2.new(0, scrollSpeed * direction)
        task.wait()
    end
end

scrollDown.MouseButton1Down:Connect(function() startScroll(1) end)
scrollDown.MouseButton1Up:Connect(function() scrollingFlag = false end)
scrollUp.MouseButton1Down:Connect(function() startScroll(-1) end)
scrollUp.MouseButton1Up:Connect(function() scrollingFlag = false end)

-- ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
local currentTrack = nil
local currentFreeze = 0
playBtn.MouseButton1Click:Connect(function()
    local id = idBox.Text
    if not id:match("rbxassetid://") then
        id = "rbxassetid://" .. id
    end
    if currentTrack then currentTrack:Stop() end
    local anim = Instance.new("Animation")
    anim.AnimationId = id
    currentTrack = humanoid:LoadAnimation(anim)
    currentTrack:Play()
end)

-- ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³Ø±Ø¹Ø©
applySpeedBtn.MouseButton1Click:Connect(function()
    if currentTrack then
        local speed = tonumber(speedBox.Text)
        if speed then
            currentTrack:AdjustSpeed(speed)
        else
            warn("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­ Ù„Ù„Ø³Ø±Ø¹Ø©")
        end
    else
        warn("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø´ØºØ§Ù„")
    end
end)

-- ØªØ¬Ù…ÙŠØ¯
freezeBtn.MouseButton1Click:Connect(function()
    if currentTrack then
        currentFreeze = currentTrack.TimePosition
        currentTrack:AdjustSpeed(0)
    end
end)

-- Ø­ÙØ¸
saveBtn.MouseButton1Click:Connect(function()
    if currentTrack then
        table.insert(dances, {
            Name = "Ø±Ù‚ØµØªÙŠ " .. tostring(#dances + 1),
            AnimationId = currentTrack.Animation.AnimationId,
            FreezeTime = currentFreeze
        })
        saveToFile()
        refreshList()
    end
end)

-- Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
function refreshList()
    for _, child in ipairs(scrolling:GetChildren()) do
        if child:IsA("Frame") then child:Destroy() end
    end
    for i, item in ipairs(dances) do
        local frame = Instance.new("Frame", scrolling)
        frame.Size = UDim2.new(1, -10, 0, 40)
        frame.BackgroundColor3 = Color3.fromRGB(60,60,60)

        local nameBtn = Instance.new("TextButton", frame)
        nameBtn.Size = UDim2.new(0.5, -5, 1, 0)
        nameBtn.Position = UDim2.new(0, 5, 0, 0)
        nameBtn.Text = item.Name
        nameBtn.TextColor3 = Color3.new(1,1,1)
        nameBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
        nameBtn.MouseButton1Click:Connect(function()
            if currentTrack then currentTrack:Stop() end
            local anim = Instance.new("Animation")
            anim.AnimationId = item.AnimationId
            currentTrack = humanoid:LoadAnimation(anim)
            currentTrack:Play()
            currentTrack.TimePosition = item.FreezeTime
            currentTrack:AdjustSpeed(0)
        end)

        local rename = Instance.new("TextButton", frame)
        rename.Size = UDim2.new(0, 30, 1, 0)
        rename.Position = UDim2.new(1, -150, 0, 0)
        rename.Text = "âœï¸"
        rename.MouseButton1Click:Connect(function()
            nameBtn.Visible = false
            local input = Instance.new("TextBox", frame)
            input.Size = nameBtn.Size
            input.Position = nameBtn.Position
            input.Text = item.Name
            input.TextColor3 = Color3.new(1,1,1)
            input.BackgroundColor3 = Color3.fromRGB(100,100,100)
            input.FocusLost:Connect(function(enter)
                if enter and input.Text ~= "" then
                    item.Name = input.Text
                    saveToFile()
                    refreshList()
                end
            end)
        end)

        local stopBtn = Instance.new("TextButton", frame)
        stopBtn.Size = UDim2.new(0, 30, 1, 0)
        stopBtn.Position = UDim2.new(1, -110, 0, 0)
        stopBtn.Text = "â›”"
        stopBtn.BackgroundColor3 = Color3.fromRGB(100,50,50)
        stopBtn.TextColor3 = Color3.new(1,1,1)
        stopBtn.MouseButton1Click:Connect(function()
            if currentTrack then
                currentTrack:Stop()
                currentTrack = nil
            end
        end)

        local unfreezeBtn = Instance.new("TextButton", frame)
        unfreezeBtn.Size = UDim2.new(0, 30, 1, 0)
        unfreezeBtn.Position = UDim2.new(1, -70, 0, 0)
        unfreezeBtn.Text = "ğŸ”“"
        unfreezeBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
        unfreezeBtn.TextColor3 = Color3.new(1,1,1)
        unfreezeBtn.MouseButton1Click:Connect(function()
            if currentTrack and currentTrack.Speed == 0 then
                currentTrack:AdjustSpeed(1)
            end
        end)

        local delete = Instance.new("TextButton", frame)
        delete.Size = UDim2.new(0, 30, 1, 0)
        delete.Position = UDim2.new(1, -30, 0, 0)
        delete.Text = "ğŸ—‘ï¸"
        delete.MouseButton1Click:Connect(function()
            table.remove(dances, i)
            saveToFile()
            refreshList()
        end)
    end
end

openBtn.MouseButton1Click:Connect(function()
    main.Visible = not main.Visible
end)

refreshList()

-- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local animator = humanoid:WaitForChild("Animator")

-- ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© =====
local DEBUG = false
local function log(...) if DEBUG then print("[DanceGUI]", ...) end end

-- Ø§Ù„Ø±ÙˆØ§Ø¨Ø·/Ø§Ù„Ù…Ù„ÙØ§Øª
local remoteURL = "https://raw.githubusercontent.com/gemzgaze-hash/Script-bang-/refs/heads/main/%D8%A7%D9%84%D8%B1%D9%82%D8%B5%D8%A7%D8%AA" -- <- Ø¹Ø¯Ù„ Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ø§Ø­ØªØ¬Øª
local saveFile = "Ø±Ù‚ØµØ§ØªÙŠ.json"           -- Ø­ÙØ¸ Ø§Ù„Ø±Ù‚ØµØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© (Ù„Ø§ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹)
local blockedFile = "Ø±Ù‚ØµØ§ØªÙŠ.blocked.json" -- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠÙ‘Ø© (Ù„Ø¥Ø®ÙØ§Ø¡ Ø±Ù‚ØµØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù†Ø¯Ùƒ ÙÙ‚Ø·)

-- Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
local remoteDances = {}   -- Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹
local localDances  = {}   -- Ù…Ù† Ø¬Ù‡Ø§Ø² Ø§Ù„Ù„Ø§Ø¹Ø¨
local blockedSet   = {}   -- AnimationId (Ø±Ù‚Ù… ÙÙ‚Ø·) Ù…Ø­Ø¸ÙˆØ±

-- ===== Ø£Ø¯ÙˆØ§Øª Ù…Ù„ÙØ§Øª Ù…Ø­Ù„ÙŠØ© Ø¢Ù…Ù†Ø© =====
local function safeIsFile(path)
    local ok = pcall(function() return isfile ~= nil end)
    if not ok or not isfile then return false end
    local ok2, exists = pcall(function() return isfile(path) end)
    return ok2 and exists
end

local function safeWrite(path, text)
    local ok = pcall(function() return writefile ~= nil end)
    if not ok or not writefile then return false end
    return pcall(function() writefile(path, text) end)
end

local function safeRead(path)
    if not safeIsFile(path) then return nil end
    local ok, res = pcall(function() return readfile(path) end)
    if ok then return res end
    return nil
end

-- ===== ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ =====
local function parseRemoteAsJson(body)
    local ok, data = pcall(function() return HttpService:JSONDecode(body) end)
    if ok and type(data) == "table" then
        -- ØªÙˆÙ‚Ù‘Ø¹: [{Name=..., AnimationId="rbxassetid://123", FreezeTime=0}, ...] Ø£Ùˆ { ... IsGroup=true ... }
        return data
    end
    return nil
end

local function parseRemoteAsLines(body)
    -- fallback: ÙƒÙ„ Ø³Ø·Ø± ÙŠØ­ØªÙˆÙŠ Ø±Ù‚Ù… Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† ÙˆØ±Ø¨Ù…Ø§ Ø§Ø³Ù…
    local items = {}
    for line in string.gmatch(body or "", "[^\r\n]+") do
        local idnum = tostring(line):match("%d+")
        if idnum then
            local rest = tostring(line):gsub("%d+", ""):gsub("[%|%-_:]+", " "):gsub("^%s+", ""):gsub("%s+$", "")
            local name = (rest ~= "" and rest) or ("Ø±Ù‚ØµØ© Ù…ÙˆÙ‚Ø¹ " .. (#items + 1))
            table.insert(items, {
                Name = name,
                AnimationId = "rbxassetid://" .. idnum,
                FreezeTime = 0
            })
        end
    end
    return items
end

local function loadRemote()
    local ok, body = pcall(function() return game:HttpGet(remoteURL) end)
    if not ok or not body or #body == 0 then
        log("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹")
        return {}
    end
    local asJson = parseRemoteAsJson(body)
    if asJson then return asJson end
    return parseRemoteAsLines(body) or {}
end

-- ===== ØªØ­Ù…ÙŠÙ„/Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ =====
local function loadLocalDances()
    local txt = safeRead(saveFile)
    if not txt then return {} end
    local ok, data = pcall(function() return HttpService:JSONDecode(txt) end)
    if ok and type(data) == "table" then return data end
    return {}
end

local function saveLocalDances()
    safeWrite(saveFile, HttpService:JSONEncode(localDances))
end

local function loadBlocked()
    local txt = safeRead(blockedFile)
    if not txt then return {} end
    local ok, data = pcall(function() return HttpService:JSONDecode(txt) end)
    local set = {}
    if ok and type(data) == "table" then
        -- ÙŠØ¯Ø¹Ù… ØµÙŠØºØ© { "12345", ... } Ø£Ùˆ { ["12345"]=true, ... }
        local isArray = (#data > 0)
        if isArray then
            for _, v in ipairs(data) do
                local idnum = tostring(v):match("%d+")
                if idnum then set[idnum] = true end
            end
        else
            for k, v in pairs(data) do
                if v then set[tostring(k)] = true end
            end
        end
    end
    return set
end

local function saveBlocked()
    -- Ø®Ø²Ù‘Ù† ÙƒÙ‚Ø§Ù…ÙˆØ³ { ["123"]=true, ... } Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
    safeWrite(blockedFile, HttpService:JSONEncode(blockedSet))
end

-- ===== Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ­Ù‘Ø¯Ø© Ù…Ø¹ Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± =====
local function idToNumberStr(animId)
    -- animId Ù‚Ø¯ ÙŠÙƒÙˆÙ† "rbxassetid://123" Ø£Ùˆ Ø±Ù‚Ù… ÙÙ‚Ø·
    if not animId then return nil end
    local s = tostring(animId)
    local num = s:match("(%d+)")
    return num
end

local function clone(tbl)
    local t = {}
    for k,v in pairs(tbl) do
        if type(v) == "table" then
            t[k] = clone(v)
        else
            t[k] = v
        end
    end
    return t
end

-- Ù†Ø³ØªØ®Ø¯Ù… Ø­Ù‚ÙˆÙ„ Ø¥Ø¶Ø§ÙÙŠØ©: Source = "remote"/"local"
local function buildMergedList()
    local merged = {}
    local seen = {} -- dedup Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ AnimationId Ù„Ù„Ø£ÙØ±Ø§Ø¯ØŒ ÙˆÙ„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¨Ù…ÙØªØ§Ø­ Ø®Ø§Øµ

    -- Ø£Ø¶Ù Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£ÙˆÙ„Ø§Ù‹ (Ù…Ø¹ ØªØµÙÙŠØ© Ø§Ù„Ù…Ø­Ø¸ÙˆØ±)
    for _, item in ipairs(remoteDances) do
        if item.IsGroup then
            -- Ù…ÙØªØ§Ø­ Ù…Ø¬Ù…ÙˆØ¹Ø©: GROUP:<id1>-<id2>-...
            local key = "GROUP:"
            if type(item.Animations) == "table" then
                local nums = {}
                for _, a in ipairs(item.Animations) do
                    table.insert(nums, idToNumberStr(a.ID or a.AnimationId or ""))
                end
                key = key .. table.concat(nums, "-")
            end
            if not seen[key] then
                local c = clone(item)
                c.Source = "remote"
                table.insert(merged, c)
                seen[key] = true
            end
        else
            local num = idToNumberStr(item.AnimationId)
            if num and not blockedSet[num] and not seen[num] then
                local c = clone(item)
                c.Source = "remote"
                table.insert(merged, c)
                seen[num] = true
            end
        end
    end

    -- Ø«Ù… Ø£Ø¶Ù Ø§Ù„Ù…Ø­Ù„ÙŠ (ÙŠØ·ØºÙ‰ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¥Ù† ØªØ´Ø§Ø¨Ù‡ Ø§Ù„Ù€ID)
    for _, item in ipairs(localDances) do
        if item.IsGroup then
            local key = "GROUP:"
            if type(item.Animations) == "table" then
                local nums = {}
                for _, a in ipairs(item.Animations) do
                    table.insert(nums, idToNumberStr(a.ID or a.AnimationId or ""))
                end
                key = key .. table.concat(nums, "-")
            end
            if not seen[key] then
                local c = clone(item)
                c.Source = "local"
                table.insert(merged, c)
                seen[key] = true
            end
        else
            local num = idToNumberStr(item.AnimationId)
            if num and not seen[num] then
                local c = clone(item)
                c.Source = "local"
                table.insert(merged, c)
                seen[num] = true
            end
        end
    end

    return merged
end

-- ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ
remoteDances = loadRemote()
localDances  = loadLocalDances()
blockedSet   = loadBlocked()

-- ====== GUI ======
local function createGUI()
    -- GUI ÙÙŠ PlayerGui
    local gui = Instance.new("ScreenGui")
    gui.Name = "DanceGUI"
    gui.ResetOnSpawn = false
    gui.Parent = player:WaitForChild("PlayerGui")

    -- Ø¥Ø·Ø§Ø± Ø±Ø¦ÙŠØ³ÙŠ
    local main = Instance.new("Frame", gui)
    main.Position = UDim2.new(0, 10, 0, 50)
    main.Size = UDim2.new(0, 370, 0, 400)
    main.Visible = true
    main.BackgroundColor3 = Color3.fromRGB(30,30,30)
    main.Active = true
    -- Draggable Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…ÙÙ‡Ù…Ù„ Ø¨Ø¨Ø¹Ø¶ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§ØªØ› Ù†ÙØ¹Ù‘Ù„ Ø³Ø­Ø¨ ÙŠØ¯ÙˆÙŠ Ø¨Ø³ÙŠØ·
    pcall(function() main.Draggable = true end)

    -- Ø²Ø± ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚
    local openBtn = Instance.new("TextButton", gui)
    openBtn.Size = UDim2.new(0, 120, 0, 30)
    openBtn.Position = UDim2.new(0, 10, 0, 10)
    openBtn.Text = "ğŸ˜ˆ ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©"
    openBtn.BackgroundColor3 = Color3.fromRGB(40,40,40)
    openBtn.TextColor3 = Color3.new(1,1,1)
    openBtn.MouseButton1Click:Connect(function()
        main.Visible = not main.Visible
    end)

    -- Scroll Frame
    local scrolling = Instance.new("ScrollingFrame", main)
    scrolling.Position = UDim2.new(0, 10, 0, 90)
    scrolling.Size = UDim2.new(1, -20, 1, -140)
    scrolling.CanvasSize = UDim2.new(0, 0, 0, 5000)
    scrolling.ScrollBarThickness = 6
    scrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y
    scrolling.BackgroundColor3 = Color3.fromRGB(20,20,20)

    local layout = Instance.new("UIListLayout", scrolling)
    layout.Padding = UDim.new(0, 5)
    layout.SortOrder = Enum.SortOrder.LayoutOrder

    -- Ø¹Ù†Ø§ØµØ± Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    local idBox = Instance.new("TextBox", main)
    idBox.Position = UDim2.new(0, 10, 0, 10)
    idBox.Size = UDim2.new(0, 150, 0, 30)
    idBox.PlaceholderText = "Animation ID"
    idBox.BackgroundColor3 = Color3.fromRGB(60,60,60)
    idBox.TextColor3 = Color3.new(1,1,1)

    local playBtn = Instance.new("TextButton", main)
    playBtn.Position = UDim2.new(0, 170, 0, 10)
    playBtn.Size = UDim2.new(0, 60, 0, 30)
    playBtn.Text = "â–¶ï¸"
    playBtn.BackgroundColor3 = Color3.fromRGB(60,100,60)
    playBtn.TextColor3 = Color3.new(1,1,1)

    local stopAllBtn = Instance.new("TextButton", main)
    stopAllBtn.Position = UDim2.new(0, 240, 0, 10)
    stopAllBtn.Size = UDim2.new(0, 70, 0, 30)
    stopAllBtn.Text = "â›” Ø§Ù„ÙƒÙ„"
    stopAllBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
    stopAllBtn.TextColor3 = Color3.new(1,1,1)

    local executeBtn = Instance.new("TextButton", main)
    executeBtn.Position = UDim2.new(0, 320, 0, 10)
    executeBtn.Size = UDim2.new(0, 20, 0, 30)
    executeBtn.Text = "Ø±Ø­Ù…Ù‡"
    executeBtn.BackgroundColor3 = Color3.fromRGB(120, 80, 160)
    executeBtn.TextColor3 = Color3.new(1,1,1)

    local speedBox = Instance.new("TextBox", main)
    speedBox.Position = UDim2.new(0, 10, 0, 45)
    speedBox.Size = UDim2.new(0, 150, 0, 30)
    speedBox.PlaceholderText = "Ø³Ø±Ø¹Ù‡ Ø§Ù„Ø±Ù‚ØµÙ‡"
    speedBox.BackgroundColor3 = Color3.fromRGB(60,60,60)
    speedBox.TextColor3 = Color3.new(1,1,1)

    local applySpeedBtn = Instance.new("TextButton", main)
    applySpeedBtn.Position = UDim2.new(0, 170, 0, 45)
    applySpeedBtn.Size = UDim2.new(0, 60, 0, 30)
    applySpeedBtn.Text = "ØªØ·Ø¨ÙŠÙ‚"
    applySpeedBtn.BackgroundColor3 = Color3.fromRGB(60,100,100)
    applySpeedBtn.TextColor3 = Color3.new(1,1,1)

    local copyIdBtn = Instance.new("TextButton", main)
    copyIdBtn.Position = UDim2.new(0, 240, 0, 45)
    copyIdBtn.Size = UDim2.new(0, 70, 0, 30)
    copyIdBtn.Text = "ğŸ“‹ ID"
    copyIdBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 120)
    copyIdBtn.TextColor3 = Color3.new(1,1,1)

    local freezeBtn = Instance.new("TextButton", main)
    freezeBtn.Position = UDim2.new(0, 10, 0, 80)
    freezeBtn.Size = UDim2.new(0, 140, 0, 30)
    freezeBtn.Text = "ğŸ§Š ØªØ¬Ù…ÙŠØ¯ Ø§Ù„ÙƒÙ„"
    freezeBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
    freezeBtn.TextColor3 = Color3.new(1,1,1)

    local freezeSingleBtn = Instance.new("TextButton", main)
    freezeSingleBtn.Position = UDim2.new(1, -150, 1, -35)
    freezeSingleBtn.Size = UDim2.new(0, 50, 0, 30)
    freezeSingleBtn.Text = "ğŸ§Š ÙˆØ§Ø­Ø¯"
    freezeSingleBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
    freezeSingleBtn.TextColor3 = Color3.new(1,1,1)

    local animBtn = Instance.new("TextButton", main)
    animBtn.Position = UDim2.new(1, -210, 1, -35)
    animBtn.Size = UDim2.new(0, 50, 0, 30)
    animBtn.BackgroundColor3 = Color3.fromRGB(80,80,120)
    animBtn.TextColor3 = Color3.new(1,1,1)
    animBtn.Text = "â€”"

    local saveBtn = Instance.new("TextButton", main)
    saveBtn.Position = UDim2.new(1, -90, 1, -35)
    saveBtn.Size = UDim2.new(0, 50, 0, 30)
    saveBtn.Text = "ğŸ’¾ Ø­ÙØ¸"
    saveBtn.BackgroundColor3 = Color3.fromRGB(100,100,30)
    saveBtn.TextColor3 = Color3.new(1,1,1)

    local saveGroupBtn = Instance.new("TextButton", main)
    saveGroupBtn.Position = UDim2.new(0, 250, 0, 80)
    saveGroupBtn.Size = UDim2.new(0, 60, 0, 30)
    saveGroupBtn.Text = "ğŸ’¾ Ù…Ø¬Ù…ÙˆØ¹Ø©"
    saveGroupBtn.BackgroundColor3 = Color3.fromRGB(100,70,30)
    saveGroupBtn.TextColor3 = Color3.new(1,1,1)

    -- Ø£Ø²Ø±Ø§Ø± Scroll
    local scrollDown = Instance.new("TextButton", main)
    scrollDown.Size = UDim2.new(0, 30, 0, 30)
    scrollDown.Position = UDim2.new(1, -35, 1, -35)
    scrollDown.Text = "â¬‡ï¸"
    scrollDown.BackgroundColor3 = Color3.fromRGB(50,50,50)
    scrollDown.TextColor3 = Color3.new(1,1,1)

    local scrollUp = Instance.new("TextButton", main)
    scrollUp.Size = UDim2.new(0, 30, 0, 30)
    scrollUp.Position = UDim2.new(1, -35, 1, -75)
    scrollUp.Text = "â¬†ï¸"
    scrollUp.BackgroundColor3 = Color3.fromRGB(50,50,50)
    scrollUp.TextColor3 = Color3.new(1,1,1)

    -- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    local activeTracks = {}
    local currentAnimId = nil
    local currentTrack = nil
    local scrollingFlag = false
    local scrollSpeed = 10

    -- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ…Ø±ÙŠØ±
    local function startScroll(direction)
        scrollingFlag = true
        while scrollingFlag do
            scrolling.CanvasPosition = scrolling.CanvasPosition + Vector2.new(0, scrollSpeed * direction)
            task.wait()
        end
    end
    scrollDown.MouseButton1Down:Connect(function() startScroll(1) end)
    scrollDown.MouseButton1Up:Connect(function() scrollingFlag = false end)
    scrollUp.MouseButton1Down:Connect(function() startScroll(-1) end)
    scrollUp.MouseButton1Up:Connect(function() scrollingFlag = false end)

    -- ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±Ø¨Øª Ø®Ø§Ø±Ø¬ÙŠ
    executeBtn.MouseButton1Click:Connect(function()
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/gemzgaze-hash/Script-bang-/main/Bang%20script", true))()
        end)
    end)

    -- Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ù€ID Ù…Ù† Ø£ÙŠ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† ÙŠØ´ØªØºÙ„
    animator.AnimationPlayed:Connect(function(track)
        if track and track.Animation and track.Animation.AnimationId then
            local id = string.match(track.Animation.AnimationId, "%d+")
            if id then
                currentAnimId = "rbxassetid://"..id
                animBtn.Text = id
            end
        end
    end)

    animBtn.MouseButton1Click:Connect(function()
        if currentAnimId and setclipboard then
            setclipboard(tostring(currentAnimId):match("%d+") or currentAnimId)
            print("ØªÙ… Ù†Ø³Ø® Animation ID:", currentAnimId)
        end
    end)

    copyIdBtn.MouseButton1Click:Connect(function()
        if currentAnimId and setclipboard then
            setclipboard(tostring(currentAnimId):match("%d+") or currentAnimId)
            print("ØªÙ… Ù†Ø³Ø® Animation ID:", currentAnimId)
        end
    end)

    -- ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù/ØªØ¬Ù…ÙŠØ¯/Ø³Ø±Ø¹Ø©
    playBtn.MouseButton1Click:Connect(function()
        local idText = idBox.Text
        local num = tostring(idText):match("%d+")
        if not num then return end
        local anim = Instance.new("Animation")
        anim.AnimationId = "rbxassetid://" .. num
        local track = animator:LoadAnimation(anim)
        track:Play()
        table.insert(activeTracks, track)
        currentTrack = track
        currentAnimId = anim.AnimationId
    end)

    stopAllBtn.MouseButton1Click:Connect(function()
        for _, track in ipairs(activeTracks) do pcall(function() track:Stop() end) end
        activeTracks = {}
        currentTrack = nil
    end)

    applySpeedBtn.MouseButton1Click:Connect(function()
        local speed = tonumber(speedBox.Text) or 1
        if currentTrack then
            currentTrack:AdjustSpeed(speed)
        end
    end)

    freezeBtn.MouseButton1Click:Connect(function()
        for _, track in ipairs(activeTracks) do
            if track.IsPlaying then track:AdjustSpeed(0) end
        end
    end)

    freezeSingleBtn.MouseButton1Click:Connect(function()
        if currentTrack and currentTrack.IsPlaying then currentTrack:AdjustSpeed(0) end
    end)

    animBtn.MouseButton1Click:Connect(function()
        if currentTrack then
            if currentTrack.IsPlaying then
                currentTrack:Stop()
                animBtn.Text = "â–¶ï¸"
            else
                currentTrack:Play()
                animBtn.Text = "â¸ï¸"
            end
        end
    end)

    -- === ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ===
    local function refreshList()
        -- Ø§Ù…Ø³Ø­ Ø§Ù„Ø¹Ù†Ø§ØµØ±
        for _, child in ipairs(scrolling:GetChildren()) do
            if child:IsA("Frame") then child:Destroy() end
        end

        local dances = buildMergedList()

        for i, item in ipairs(dances) do
            local frame = Instance.new("Frame", scrolling)
            frame.Size = UDim2.new(1, -10, 0, 40)
            frame.BackgroundColor3 = Color3.fromRGB(60,60,60)

            local nameBtn = Instance.new("TextButton", frame)
            nameBtn.Size = UDim2.new(0.5, -5, 1, 0)
            nameBtn.Position = UDim2.new(0, 5, 0, 0)
            nameBtn.Text = (item.Name or ("Ø±Ù‚ØµØ© "..i)) .. (item.Source=="remote" and "  ğŸŒ" or "")
            nameBtn.TextColor3 = Color3.new(1,1,1)
            nameBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)

            nameBtn.MouseButton1Click:Connect(function()
                -- Ø£ÙˆÙ‚Ù Ø§Ù„Ø­Ø§Ù„ÙŠ
                for _, t in ipairs(activeTracks) do pcall(function() t:Stop() end) end
                activeTracks = {}

                if item.IsGroup then
                    for _, animData in ipairs(item.Animations or {}) do
                        local id = (animData.ID or animData.AnimationId or "")
                        local num = idToNumberStr(id)
                        if num then
                            local anim = Instance.new("Animation")
                            anim.AnimationId = "rbxassetid://"..num
                            local track = animator:LoadAnimation(anim)
                            track:Play()
                            track.TimePosition = tonumber(animData.FreezeTime) or 0
                            track:AdjustSpeed(0)
                            table.insert(activeTracks, track)
                        end
                    end
                else
                    local num = idToNumberStr(item.AnimationId)
                    if num then
                        local anim = Instance.new("Animation")
                        anim.AnimationId = "rbxassetid://"..num
                        local track = animator:LoadAnimation(anim)
                        track:Play()
                        if item.FreezeTime then
                            track.TimePosition = tonumber(item.FreezeTime) or 0
                            track:AdjustSpeed(0)
                        end
                        table.insert(activeTracks, track)
                        currentTrack = track
                        currentAnimId = "rbxassetid://"..num
                        idBox.Text = num
                    end
                end
            end)

            local renameBtn = Instance.new("TextButton", frame)
            renameBtn.Size = UDim2.new(0.2, -5, 1, 0)
            renameBtn.Position = UDim2.new(0.5, 5, 0, 0)
            renameBtn.Text = "âœï¸"
            renameBtn.BackgroundColor3 = Color3.fromRGB(70,70,100)
            renameBtn.TextColor3 = Color3.new(1,1,1)

            renameBtn.MouseButton1Click:Connect(function()
                if item.Source == "remote" then
                    -- Ù†Ù†Ø³Ø®Ù‡Ø§ ÙƒÙ…Ø­Ù„ÙŠØ© Ø«Ù… Ù†Ø¹ÙŠØ¯ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                    local copy = clone(item)
                    copy.Source = "local"
                    -- ØªØ£ÙƒØ¯ Ù…Ù† ØµÙŠØºØ© Ø§Ù„ÙØ±Ø¯ÙŠ/Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
                    table.insert(localDances, copy)
                    saveLocalDances()
                    refreshList()
                    return
                end

                local inputGui = Instance.new("ScreenGui", player.PlayerGui)
                inputGui.Name = "RenameInputGui"

                local background = Instance.new("Frame", inputGui)
                background.Size = UDim2.new(0, 300, 0, 150)
                background.Position = UDim2.new(0.5, -150, 0.5, -75)
                background.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
                background.BorderSizePixel = 2
                background.BorderColor3 = Color3.fromRGB(80, 80, 80)

                local title = Instance.new("TextLabel", background)
                title.Size = UDim2.new(1, 0, 0, 30)
                title.Position = UDim2.new(0, 0, 0, 10)
                title.Text = "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:"
                title.TextColor3 = Color3.new(1, 1, 1)
                title.BackgroundTransparency = 1

                local inputBox = Instance.new("TextBox", background)
                inputBox.Size = UDim2.new(0, 260, 0, 30)
                inputBox.Position = UDim2.new(0.5, -130, 0, 50)
                inputBox.PlaceholderText = "Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§"
                inputBox.Text = item.Name or ("Ø±Ù‚ØµØ©")
                inputBox.TextColor3 = Color3.new(1, 1, 1)
                inputBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
                inputBox.ClearTextOnFocus = false

                local confirmBtn = Instance.new("TextButton", background)
                confirmBtn.Size = UDim2.new(0, 100, 0, 30)
                confirmBtn.Position = UDim2.new(0.5, -110, 0, 100)
                confirmBtn.Text = "ØªØ£ÙƒÙŠØ¯"
                confirmBtn.TextColor3 = Color3.new(1, 1, 1)
                confirmBtn.BackgroundColor3 = Color3.fromRGB(60, 100, 60)

                local cancelBtn = Instance.new("TextButton", background)
                cancelBtn.Size = UDim2.new(0, 100, 0, 30)
                cancelBtn.Position = UDim2.new(0.5, 10, 0, 100)
                cancelBtn.Text = "Ø¥Ù„ØºØ§Ø¡"
                cancelBtn.TextColor3 = Color3.new(1, 1, 1)
                cancelBtn.BackgroundColor3 = Color3.fromRGB(100, 60, 60)

                inputBox:CaptureFocus()

                local function doRename()
                    if inputBox.Text ~= "" then
                        item.Name = inputBox.Text
                        -- Ø¹Ø¯Ù‘Ù„ ÙÙŠ localDances
                        for idx, it in ipairs(localDances) do
                            local match = (it.IsGroup and item.IsGroup) or (idToNumberStr(it.AnimationId) == idToNumberStr(item.AnimationId))
                            if match then
                                localDances[idx] = item
                                break
                            end
                        end
                        saveLocalDances()
                        inputGui:Destroy()
                        refreshList()
                    else
                        inputGui:Destroy()
                    end
                end

                confirmBtn.MouseButton1Click:Connect(doRename)
                cancelBtn.MouseButton1Click:Connect(function() inputGui:Destroy() end)
                inputBox.FocusLost:Connect(function(enterPressed) if enterPressed then doRename() end end)
            end)

            local deleteBtn = Instance.new("TextButton", frame)
            deleteBtn.Size = UDim2.new(0.2, -5, 1, 0)
            deleteBtn.Position = UDim2.new(0.7, 5, 0, 0)
            deleteBtn.Text = "ğŸ—‘ï¸"
            deleteBtn.BackgroundColor3 = Color3.fromRGB(100,70,70)
            deleteBtn.TextColor3 = Color3.new(1,1,1)

            deleteBtn.MouseButton1Click:Connect(function()
                if item.Source == "remote" and not item.IsGroup then
                    local num = idToNumberStr(item.AnimationId)
                    if num then
                        blockedSet[num] = true
                        saveBlocked()
                    end
                else
                    -- Ø§Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…Ø­Ù„ÙŠ
                    local newLocal = {}
                    if item.IsGroup then
                        -- Ù‚Ø§Ø±Ù† Ø¨Ø§Ù„Ù…Ø­ØªÙˆÙ‰
                        for _, it in ipairs(localDances) do
                            if not it.IsGroup then
                                table.insert(newLocal, it)
                            else
                                -- Ù‚Ø§Ø±Ù† Ø£Ø·ÙˆØ§Ù„ ÙˆÙ‚ÙŠÙ… Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
                                local same = false
                                if type(it.Animations)=="table" and type(item.Animations)=="table" and #it.Animations == #item.Animations then
                                    same = true
                                    for k=1,#it.Animations do
                                        local ida = idToNumberStr(it.Animations[k].ID or it.Animations[k].AnimationId)
                                        local idb = idToNumberStr(item.Animations[k].ID or item.Animations[k].AnimationId)
                                        if ida ~= idb then same = false break end
                                    end
                                end
                                if not same then table.insert(newLocal, it) end
                            end
                        end
                    else
                        local targetNum = idToNumberStr(item.AnimationId)
                        for _, it in ipairs(localDances) do
                            local num = idToNumberStr(it.AnimationId)
                            if not (num == targetNum and not it.IsGroup) then
                                table.insert(newLocal, it)
                            end
                        end
                    end
                    localDances = newLocal
                    saveLocalDances()
                end
                refreshList()
            end)
        end
    end

    -- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸
    saveBtn.MouseButton1Click:Connect(function()
        if not currentAnimId then return end
        local entry = {
            Name = "Ø±Ù‚ØµØ© " .. tostring(#localDances + 1),
            AnimationId = currentAnimId,
            FreezeTime = currentTrack and currentTrack.TimePosition or 0
        }
        table.insert(localDances, entry)
        saveLocalDances()
        refreshList()
    end)

    saveGroupBtn.MouseButton1Click:Connect(function()
        if #activeTracks > 0 then
            local groupAnimations = {}
            for _, track in ipairs(activeTracks) do
                local idNum = idToNumberStr(track.Animation and track.Animation.AnimationId or "")
                if idNum then
                    table.insert(groupAnimations, {
                        ID = "rbxassetid://"..idNum,
                        FreezeTime = track.TimePosition or 0
                    })
                end
            end
            table.insert(localDances, {
                Name = "Ù…Ø¬Ù…ÙˆØ¹Ø© Ø±Ù‚ØµØ§Øª " .. tostring(#localDances + 1),
                IsGroup = true,
                Animations = groupAnimations
            })
            saveLocalDances()
            refreshList()
        end
    end)

    -- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    refreshList()
    return main
end

-- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
local mainFrame = createGUI()

print("ØªÙ… ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ø¬Ù‡Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø±Ù‚ØµØ§Øª Ø¨Ù†Ø¬Ø§Ø­!")
print("Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± 'ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©' ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„ÙŠØ³Ø±Ù‰ Ø§Ù„Ø¹Ù„ÙŠØ§ Ù„ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©")

-- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

-- Ù…Ù„Ù Ø§Ù„Ø­ÙØ¸
local dances = {}
local saveFile = "Ø±Ù‚ØµØ§ØªÙŠ.json"
if isfile(saveFile) then
    local success, data = pcall(function()
        return HttpService:JSONDecode(readfile(saveFile))
    end)
    if success then dances = data end
end

local function saveToFile()
    writefile(saveFile, HttpService:JSONEncode(dances))
end

-- GUI
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "DanceGUI"

-- Ø¬Ø¹Ù„ Ø§Ù„Ù†Ø§ÙØ°Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø³Ø­Ø¨
local dragging, dragInput, dragStart, startPos
local function updateInput(input)
    local delta = input.Position - dragStart
    main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

local openBtn = Instance.new("TextButton", gui)
openBtn.Size = UDim2.new(0, 100, 0, 30)
openBtn.Position = UDim2.new(0, 10, 0, 10)
openBtn.Text = "ğŸ“‚ ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©"
openBtn.BackgroundColor3 = Color3.fromRGB(40,40,40)
openBtn.TextColor3 = Color3.new(1,1,1)

openBtn.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = main.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

openBtn.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        updateInput(input)
    end
end)

local main = Instance.new("Frame", gui)
main.Position = UDim2.new(0, 10, 0, 50)
main.Size = UDim2.new(0, 320, 0, 400)
main.Visible = true
main.BackgroundColor3 = Color3.fromRGB(30,30,30)
main.Active = true
main.Draggable = true

local scrolling = Instance.new("ScrollingFrame", main)
scrolling.Position = UDim2.new(0, 10, 0, 90)
scrolling.Size = UDim2.new(1, -20, 1, -140)
scrolling.CanvasSize = UDim2.new(0, 0, 0, 5000)
scrolling.ScrollBarThickness = 6
scrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y
scrolling.BackgroundColor3 = Color3.fromRGB(20,20,20)

local layout = Instance.new("UIListLayout", scrolling)
layout.Padding = UDim.new(0, 5)
layout.SortOrder = Enum.SortOrder.LayoutOrder

-- Ø¥Ø¯Ø®Ø§Ù„ ID ÙˆØªØ´ØºÙŠÙ„
local idBox = Instance.new("TextBox", main)
idBox.Position = UDim2.new(0, 10, 0, 10)
idBox.Size = UDim2.new(0, 150, 0, 30)
idBox.PlaceholderText = "Animation ID"
idBox.BackgroundColor3 = Color3.fromRGB(60,60,60)
idBox.TextColor3 = Color3.new(1,1,1)

local playBtn = Instance.new("TextButton", main)
playBtn.Position = UDim2.new(0, 170, 0, 10)
playBtn.Size = UDim2.new(0, 60, 0, 30)
playBtn.Text = "â–¶ï¸"
playBtn.BackgroundColor3 = Color3.fromRGB(60,100,60)
playBtn.TextColor3 = Color3.new(1,1,1)

local stopAllBtn = Instance.new("TextButton", main)
stopAllBtn.Position = UDim2.new(0, 240, 0, 10)
stopAllBtn.Size = UDim2.new(0, 70, 0, 30)
stopAllBtn.Text = "â›” Ø§Ù„ÙƒÙ„"
stopAllBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
stopAllBtn.TextColor3 = Color3.new(1,1,1)

local speedBox = Instance.new("TextBox", main)
speedBox.Position = UDim2.new(0, 10, 0, 45)
speedBox.Size = UDim2.new(0, 150, 0, 30)
speedBox.PlaceholderText = "Ù‡Ù†Ø§ ØªØ®ØªØ§Ø± Ø³Ø±Ø¹Ù‡"
speedBox.BackgroundColor3 = Color3.fromRGB(60,60,60)
speedBox.TextColor3 = Color3.new(1,1,1)

local applySpeedBtn = Instance.new("TextButton", main)
applySpeedBtn.Position = UDim2.new(0, 170, 0, 45)
applySpeedBtn.Size = UDim2.new(0, 60, 0, 30)
applySpeedBtn.Text = "ØªØ·Ø¨ÙŠÙ‚"
applySpeedBtn.BackgroundColor3 = Color3.fromRGB(60,100,100)
applySpeedBtn.TextColor3 = Color3.new(1,1,1)

local freezeBtn = Instance.new("TextButton", main)
freezeBtn.Position = UDim2.new(0, 10, 0, 80)
freezeBtn.Size = UDim2.new(0, 140, 0, 30)
freezeBtn.Text = "ğŸ§Š ØªØ¬Ù…ÙŠØ¯ Ø§Ù„ÙƒÙ„"
freezeBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
freezeBtn.TextColor3 = Color3.new(1,1,1)

local freezeSingleBtn = Instance.new("TextButton", main)
freezeSingleBtn.Position = UDim2.new(1, -150, 1, -35)
freezeSingleBtn.Size = UDim2.new(0, 50, 0, 30)
freezeSingleBtn.Text = "ğŸ§Š ÙˆØ§Ø­Ø¯"
freezeSingleBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
freezeSingleBtn.TextColor3 = Color3.new(1,1,1)

local animBtn = Instance.new("TextButton", main)
animBtn.Position = UDim2.new(1, -210, 1, -35)
animBtn.Size = UDim2.new(0, 50, 0, 30)
animBtn.BackgroundColor3 = Color3.fromRGB(80,80,120)
animBtn.TextColor3 = Color3.new(1,1,1)
animBtn.Text = "â€”"

local saveBtn = Instance.new("TextButton", main)
saveBtn.Position = UDim2.new(1, -90, 1, -35)
saveBtn.Size = UDim2.new(0, 50, 0, 30)
saveBtn.Text = "ğŸ’¾ Ø­ÙØ¸"
saveBtn.BackgroundColor3 = Color3.fromRGB(100,100,30)
saveBtn.TextColor3 = Color3.new(1,1,1)

local saveGroupBtn = Instance.new("TextButton", main)
saveGroupBtn.Position = UDim2.new(0, 250, 0, 80)
saveGroupBtn.Size = UDim2.new(0, 60, 0, 30)
saveGroupBtn.Text = "ğŸ’¾ Ù…Ø¬Ù…ÙˆØ¹Ø©"
saveGroupBtn.BackgroundColor3 = Color3.fromRGB(100,70,30)
saveGroupBtn.TextColor3 = Color3.new(1,1,1)

-- Ø£Ø³Ù‡Ù… Ø§Ù„ØªÙ…Ø±ÙŠØ±
local scrollDown = Instance.new("TextButton", main)
scrollDown.Size = UDim2.new(0, 30, 0, 30)
scrollDown.Position = UDim2.new(1, -35, 1, -35)
scrollDown.Text = "â¬‡ï¸"
scrollDown.BackgroundColor3 = Color3.fromRGB(50,50,50)
scrollDown.TextColor3 = Color3.new(1,1,1)

local scrollUp = Instance.new("TextButton", main)
scrollUp.Size = UDim2.new(0, 30, 0, 30)
scrollUp.Position = UDim2.new(1, -35, 1, -75)
scrollUp.Text = "â¬†ï¸"
scrollUp.BackgroundColor3 = Color3.fromRGB(50,50,50)
scrollUp.TextColor3 = Color3.new(1,1,1)

-- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
local activeTracks = {}
local currentAnimId = nil
local currentTrack = nil
local scrollingFlag = false
local scrollSpeed = 6

-- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ…Ø±ÙŠØ±
local function startScroll(direction)
    scrollingFlag = true
    while scrollingFlag do
        scrolling.CanvasPosition = scrolling.CanvasPosition + Vector2.new(0, scrollSpeed * direction)
        task.wait()
    end
end

scrollDown.MouseButton1Down:Connect(function() startScroll(1) end)
scrollDown.MouseButton1Up:Connect(function() scrollingFlag = false end)
scrollUp.MouseButton1Down:Connect(function() startScroll(-1) end)
scrollUp.MouseButton1Up:Connect(function() scrollingFlag = false end)

-- ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
playBtn.MouseButton1Click:Connect(function()
    local id = idBox.Text
    if id == "" then return end
    
    if not id:match("rbxassetid://") then
        id = "rbxassetid://" .. id
    end
    
    local anim = Instance.new("Animation")
    anim.AnimationId = id
    local newTrack = humanoid:LoadAnimation(anim)
    newTrack:Play()
    
    table.insert(activeTracks, {
        Track = newTrack,
        ID = id,
        Speed = 1,
        FreezeTime = nil
    })
    
    currentTrack = newTrack
end)

-- Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒÙ„
stopAllBtn.MouseButton1Click:Connect(function()
    for _, data in ipairs(activeTracks) do
        data.Track:Stop()
    end
    activeTracks = {}
    currentTrack = nil
end)

-- ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³Ø±Ø¹Ø©
applySpeedBtn.MouseButton1Click:Connect(function()
    local speed = tonumber(speedBox.Text)
    if speed then
        if currentTrack then
            currentTrack:AdjustSpeed(speed)
            for _, data in ipairs(activeTracks) do
                if data.Track == currentTrack then
                    data.Speed = speed
                    break
                end
            end
        end
    end
end)

-- ØªØ¬Ù…ÙŠØ¯ Ø§Ù„ÙƒÙ„
freezeBtn.MouseButton1Click:Connect(function()
    for _, data in ipairs(activeTracks) do
        data.FreezeTime = data.Track.TimePosition
        data.Track:AdjustSpeed(0)
        data.Speed = 0
    end
end)

-- ØªØ¬Ù…ÙŠØ¯ ÙˆØ§Ø­Ø¯
freezeSingleBtn.MouseButton1Click:Connect(function()
    if currentTrack then
        for _, data in ipairs(activeTracks) do
            if data.Track == currentTrack then
                data.FreezeTime = data.Track.TimePosition
                data.Track:AdjustSpeed(0)
                data.Speed = 0
                break
            end
        end
    end
end)

-- Ù†Ø³Ø® Ø§Ù„Ù€ ID
local animator = humanoid:WaitForChild("Animator")
animator.AnimationPlayed:Connect(function(track)
    if track and track.Animation and track.Animation.AnimationId then
        local id = string.match(track.Animation.AnimationId, "%d+")
        if id then
            currentAnimId = id
            animBtn.Text = id
        end
    end
end)

animBtn.MouseButton1Click:Connect(function()
    if currentAnimId then
        if setclipboard then
            setclipboard(currentAnimId)
            print("ØªÙ… Ù†Ø³Ø® Animation ID:", currentAnimId)
        end
    end
end)

-- Ø­ÙØ¸ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† ÙˆØ§Ø­Ø¯
saveBtn.MouseButton1Click:Connect(function()
    if currentTrack then
        table.insert(dances, {
            Name = "Ø±Ù‚ØµØªÙŠ " .. tostring(#dances + 1),
            AnimationId = currentTrack.Animation.AnimationId,
            FreezeTime = currentTrack.TimePosition,
            IsGroup = false
        })
        saveToFile()
        refreshList()
    end
end)

-- Ø­ÙØ¸ Ù…Ø¬Ù…ÙˆØ¹Ø©
saveGroupBtn.MouseButton1Click:Connect(function()
    if #activeTracks == 0 then return end
    
    local combinedAnimations = {}
    for _, data in ipairs(activeTracks) do
        if data.FreezeTime then
            table.insert(combinedAnimations, {
                ID = data.ID,
                FreezeTime = data.FreezeTime
            })
        end
    end
    
    if #combinedAnimations > 0 then
        table.insert(dances, {
            Name = "Ù…Ø¬Ù…ÙˆØ¹Ø© Ø±Ù‚Øµ " .. tostring(#dances + 1),
            Animations = combinedAnimations,
            IsGroup = true
        })
        saveToFile()
        refreshList()
    else
        print("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ù†ÙŠÙ…ÙŠØ´ÙŠÙ†Ø§Øª Ù…Ø¬Ù…Ø¯Ø© Ù„Ù„Ø­ÙØ¸")
    end
end)

-- Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
function refreshList()
    for _, child in ipairs(scrolling:GetChildren()) do
        if child:IsA("Frame") then child:Destroy() end
    end
    
    for i, item in ipairs(dances) do
        local frame = Instance.new("Frame", scrolling)
        frame.Size = UDim2.new(1, -10, 0, 40)
        frame.BackgroundColor3 = Color3.fromRGB(60,60,60)

        local nameBtn = Instance.new("TextButton", frame)
        nameBtn.Size = UDim2.new(0.5, -5, 1, 0)
        nameBtn.Position = UDim2.new(0, 5, 0, 0)
        nameBtn.Text = item.Name
        nameBtn.TextColor3 = Color3.new(1,1,1)
        nameBtn.BackgroundColor3 = Color3.fromRGB(80,80,80)
        
        nameBtn.MouseButton1Click:Connect(function()
            -- Ø¥ÙŠÙ‚Ø§Ù ÙƒÙ„ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´ÙŠÙ†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            for _, data in ipairs(activeTracks) do
                data.Track:Stop()
            end
            activeTracks = {}
            
            if item.IsGroup then
                -- ØªØ´ØºÙŠÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´ÙŠÙ†Ø§Øª
                for _, animData in ipairs(item.Animations) do
                    local anim = Instance.new("Animation")
                    anim.AnimationId = animData.ID
                    local track = humanoid:LoadAnimation(anim)
                    track:Play()
                    track.TimePosition = animData.FreezeTime
                    track:AdjustSpeed(0)
                    
                    table.insert(activeTracks, {
                        Track = track,
                        ID = animData.ID,
                        Speed = 0,
                        FreezeTime = animData.FreezeTime
                    })
                end
            else
                -- ØªØ´ØºÙŠÙ„ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù…ÙØ±Ø¯
                local anim = Instance.new("Animation")
                anim.AnimationId = item.AnimationId
                local track = humanoid:LoadAnimation(anim)
                track:Play()
                if item.FreezeTime then
                    track.TimePosition = item.FreezeTime
                    track:AdjustSpeed(0)
                end
                
                table.insert(activeTracks, {
                    Track = track,
                    ID = item.AnimationId,
                    Speed = item.FreezeTime and 0 or 1,
                    FreezeTime = item.FreezeTime
                })
                
                currentTrack = track
            end
        end)

        local rename = Instance.new("TextButton", frame)
        rename.Size = UDim2.new(0, 30, 1, 0)
        rename.Position = UDim2.new(1, -150, 0, 0)
        rename.Text = "âœï¸"
        rename.MouseButton1Click:Connect(function()
            nameBtn.Visible = false
            local input = Instance.new("TextBox", frame)
            input.Size = nameBtn.Size
            input.Position = nameBtn.Position
            input.Text = item.Name
            input.TextColor3 = Color3.new(1,1,1)
            input.BackgroundColor3 = Color3.fromRGB(100,100,100)
            input.FocusLost:Connect(function(enter)
                if enter and input.Text ~= "" then
                    item.Name = input.Text
                    saveToFile()
                    refreshList()
                end
            end)
        end)

        local stopBtn = Instance.new("TextButton", frame)
        stopBtn.Size = UDim2.new(0, 30, 1, 0)
        stopBtn.Position = UDim2.new(1, -110, 0, 0)
        stopBtn.Text = "â›”"
        stopBtn.BackgroundColor3 = Color3.fromRGB(100,50,50)
        stopBtn.TextColor3 = Color3.new(1,1,1)
        stopBtn.MouseButton1Click:Connect(function()
            for _, data in ipairs(activeTracks) do
                data.Track:Stop()
            end
            activeTracks = {}
        end)

        local unfreezeBtn = Instance.new("TextButton", frame)
        unfreezeBtn.Size = UDim2.new(0, 30, 1, 0)
        unfreezeBtn.Position = UDim2.new(1, -70, 0, 0)
        unfreezeBtn.Text = "ğŸ”“"
        unfreezeBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
        unfreezeBtn.TextColor3 = Color3.new(1,1,1)
        unfreezeBtn.MouseButton1Click:Connect(function()
            for _, data in ipairs(activeTracks) do
                if data.Speed == 0 then
                    data.Track:AdjustSpeed(1)
                    data.Speed = 1
                end
            end
        end)

        local delete = Instance.new("TextButton", frame)
        delete.Size = UDim2.new(0, 30, 1, 0)
        delete.Position = UDim2.new(1, -30, 0, 0)
        delete.Text = "ğŸ—‘ï¸"
        delete.MouseButton1Click:Connect(function()
            table.remove(dances, i)
            saveToFile()
            refreshList()
        end)
    end
end

openBtn.MouseButton1Click:Connect(function()
    main.Visible = not main.Visible
end)

refreshList()
